@model Pos.Models.AdminSaleEditVm
@{
    ViewData["Title"] = $"Edit Sale #{Model.Id}";
}

<h1>@ViewData["Title"]</h1>

@if (TempData["Success"] is string ok)
{
  <div class="alert alert-success">@ok</div>
}

<form asp-action="EditSale" method="post">
  <input type="hidden" asp-for="Id" />

  <div class="mb-3">
    <label asp-for="SalesPerson" class="form-label"></label>
    <input asp-for="SalesPerson" class="form-control" />
    <span asp-validation-for="SalesPerson" class="text-danger"></span>
  </div>

  <div class="mb-3">
    <label asp-for="SaleDate" class="form-label"></label>
    <input asp-for="SaleDate" type="datetime-local" class="form-control" />
  </div>

  <h4>Lines</h4>
  <table class="table align-middle">
    <thead>
      <tr>
        <th style="width:35%">Service</th>
        <th style="width:15%">Qty</th>
        <th style="width:20%">Unit Price</th>
        <th style="width:20%">Line Total</th>
        <th style="width:10%"></th>
      </tr>
    </thead>
    <tbody>
@for (int i = 0; i < Model.Lines.Count; i++)
{
    <tr>
      <td>
        <input type="hidden" asp-for="Lines[@i].Id" />
        <select asp-for="Lines[@i].ServiceId" class="form-select"
                asp-items="@(new SelectList(Model.Services, "Id", "Name", Model.Lines[i].ServiceId))">
          <option value="">-- select service --</option>
        </select>
      </td>
      <td><input asp-for="Lines[@i].Quantity" class="form-control" /></td>
      <td><input asp-for="Lines[@i].UnitPrice" class="form-control" /></td>
      <td>
        @{
          var lt = Model.Lines[i].Quantity * Model.Lines[i].UnitPrice;
        }
        @lt.ToString("C")
      </td>
      <td>
        <button name="Command" value="RemoveLine" class="btn btn-sm btn-outline-danger"
                formaction="@Url.Action("EditSale", new { id = Model.Id })"
                formmethod="post">
          Remove
        </button>
        <input type="hidden" name="CommandIndex" value="@i" />
      </td>
    </tr>
}
    </tbody>
  </table>

  <button name="Command" value="AddLine" class="btn btn-sm btn-outline-secondary"
          formaction="@Url.Action("EditSale", new { id = Model.Id })"
          formmethod="post">
    + Add line
  </button>

  <div class="mt-3"><strong>Grand Total:</strong> @Model.GrandTotal.ToString("C")</div>

  <div class="mt-4 d-flex gap-2">
    <button type="submit" class="btn btn-primary">Save Changes</button>
    <a asp-controller="Admin" asp-action="Index" class="btn btn-secondary">Back</a>
  </div>
</form>

@section Scripts { <partial name="_ValidationScriptsPartial" /> }
